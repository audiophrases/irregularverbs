<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Irregular Verb Coach</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", Roboto, sans-serif;
      --accent: #2f7de1;
      --accent-soft: rgba(47, 125, 225, 0.15);
      --bg-soft: rgba(0, 0, 0, 0.05);
      --danger: #c0392b;
      --success: #1e8449;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f2f4f8;
      color: #111827;
      font-size: 16px;
      line-height: 1.5;
    }

    body.dark {
      background: #0f172a;
      color: #e2e8f0;
    }

    header {
      background: linear-gradient(135deg, #1d4ed8, #9333ea);
      color: white;
      padding: 2.5rem 1.5rem;
      text-align: center;
      box-shadow: 0 8px 30px rgba(17, 24, 39, 0.25);
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    main {
      margin: -2rem auto 4rem;
      padding: 0 1rem 4rem;
      max-width: 1200px;
    }

    section {
      background: white;
      border-radius: 18px;
      padding: 1.5rem;
      margin-top: 2rem;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
    }

    body.dark section {
      background: #111827;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.35);
    }

    h2 {
      margin-top: 0;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h2 span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 700;
    }

    .controls-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    select,
    input[type="number"],
    button,
    input[type="search"] {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.15);
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    select,
    input[type="number"],
    input[type="search"] {
      color: inherit;
    }

    select {
      background-color: white;
      background-image: linear-gradient(transparent, transparent);
    }

    select option {
      color: #111827;
    }

    body.dark select,
    body.dark input[type="number"],
    body.dark button,
    body.dark input[type="search"] {
      background: rgba(17, 24, 39, 0.9);
      color: inherit;
      border: 1px solid rgba(226, 232, 240, 0.2);
    }

    body.dark select {
      background-color: rgba(17, 24, 39, 0.95);
    }

    body.dark select option {
      color: #e2e8f0;
      background-color: #0f172a;
    }

    button {
      cursor: pointer;
      background: var(--accent);
      color: white;
      border: none;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover,
    button:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
    }

    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
      box-shadow: none;
    }

    .study-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.75rem;
      align-items: center;
    }

    .study-play-button {
      width: auto;
      padding: 0.75rem 1.25rem;
      border-radius: 14px;
    }

    .dark-mode-control {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .selection-summary {
      justify-content: flex-end;
      font-weight: 600;
      gap: 0.35rem;
    }

    .selection-arrow {
      color: var(--accent);
      font-size: 1rem;
      letter-spacing: 0.15em;
    }

    .selection-count {
      font-size: 1.1rem;
    }

    body.dark .selection-arrow {
      color: #bfdbfe;
    }

    button.icon-button {
      width: 2.75rem;
      height: 2.75rem;
      min-width: 2.75rem;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      font-size: 1.35rem;
      background: rgba(37, 99, 235, 0.12);
      color: var(--accent);
    }

    button.icon-button:hover,
    button.icon-button:focus-visible {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
    }

    body.dark button.icon-button {
      background: rgba(59, 130, 246, 0.18);
      color: #e2e8f0;
      border: 1px solid rgba(226, 232, 240, 0.25);
    }

    .study-mode-status {
      margin-top: 0.75rem;
      font-size: 0.95rem;
      color: #475569;
    }

    body.dark .study-mode-status {
      color: #cbd5f5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
      overflow: hidden;
      border-radius: 14px;
    }

    table thead {
      background: rgba(37, 99, 235, 0.08);
    }

    body.dark table thead {
      background: rgba(59, 130, 246, 0.16);
    }

    th,
    td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }

    tbody tr:hover {
      background: rgba(37, 99, 235, 0.08);
    }

    .empty-row td {
      text-align: center;
      font-style: italic;
      padding: 1rem;
      color: #475569;
      background: rgba(148, 163, 184, 0.18);
    }

    body.dark .empty-row td {
      color: #cbd5f5;
      background: rgba(148, 163, 184, 0.25);
    }

    .verb-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .stats-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      color: white;
    }

    .stats-pill.good {
      background: var(--success);
    }

    .stats-pill.bad {
      background: var(--danger);
    }

    .stats-pill.neutral {
      background: #6b7280;
    }

    .quiz-card {
      display: grid;
      gap: 1rem;
      font-size: 1.05rem;
      line-height: 1.65;
    }

    .quiz-card h3 {
      font-size: 1.35rem;
      margin-bottom: 0.25rem;
    }

    .quiz-description {
      margin: 0;
      color: #475569;
    }

    body.dark .quiz-description {
      color: #cbd5f5;
    }

    .quiz-actions {
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .quiz-actions > .flex {
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .flashcard-pane {
      display: grid;
      gap: 0.75rem;
      padding: 1rem;
      border-radius: 12px;
      background: rgba(37, 99, 235, 0.1);
    }

    body.dark .flashcard-pane {
      background: rgba(59, 130, 246, 0.18);
    }

    .flashcard-pane p {
      margin: 0;
    }

    #flashcardAnswer {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .advanced-options {
      margin-top: 1.25rem;
      border: 1px solid rgba(15, 23, 42, 0.12);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      background: rgba(148, 163, 184, 0.12);
    }

    body.dark .advanced-options {
      border-color: rgba(226, 232, 240, 0.2);
      background: rgba(30, 41, 59, 0.45);
    }

    .advanced-options summary {
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .advanced-options .controls-grid {
      margin-top: 1rem;
    }

    .advanced-actions {
      justify-content: flex-start;
    }

    .quiz-status {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      font-weight: 600;
    }

    .quiz-status span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.08);
    }

    .quiz-result {
      padding: 1rem;
      border-radius: 12px;
      background: rgba(30, 136, 229, 0.08);
      font-weight: 600;
      display: none;
    }

    .quiz-result.correct {
      background: rgba(30, 136, 229, 0.18);
      color: var(--success);
    }

    .quiz-result.incorrect {
      background: rgba(192, 57, 43, 0.15);
      color: var(--danger);
    }

    .hard-list {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }

    .hard-card {
      border-radius: 12px;
      padding: 1rem;
      background: rgba(192, 57, 43, 0.12);
      border: 1px solid rgba(192, 57, 43, 0.25);
    }

    .empty-state {
      padding: 1rem;
      border-radius: 12px;
      background: rgba(148, 163, 184, 0.18);
      text-align: center;
      font-style: italic;
    }

    footer {
      text-align: center;
      padding: 2rem 1rem 3rem;
      font-size: 0.9rem;
      color: #475569;
    }

    body.dark footer {
      color: #cbd5f5;
    }

    .flex {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    @media (max-width: 768px) {
      table {
        display: block;
        overflow-x: auto;
      }

      th,
      td {
        white-space: nowrap;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Irregular Verb Coach</h1>
  </header>

  <main>
    <section aria-labelledby="study-controls">
      <h2 id="study-controls"><span>1</span>Choose how to study</h2>
      <div class="controls-grid">
        <div>
          <p style="margin: 0; font-weight: 600;">Start with the curated common verbs.</p>
          <div class="study-actions">
            <button type="button" id="playAllBtn" class="study-play-button">Play all pronunciations</button>
          </div>
          <div id="studyModeStatus" class="study-mode-status" aria-live="polite"></div>
        </div>
        <div>
          <label for="searchInput">Quick search</label>
          <input type="search" id="searchInput" placeholder="Search by verb or Catalan meaning" />
        </div>
        <div class="dark-mode-control">
          <label class="sr-only" for="darkModeToggle">Toggle dark mode</label>
          <button id="darkModeToggle" type="button" class="icon-button" aria-label="Toggle dark mode" title="Toggle dark mode">
            <span aria-hidden="true">🌙</span>
          </button>
        </div>
      </div>
      <details class="advanced-options">
        <summary>More verbs</summary>
        <p style="margin: 0.5rem 0 0;">Fine-tune the list with filters or restore the simplified view.</p>
        <div class="controls-grid">
          <div>
            <label for="frequencyFilterSelect">Filter by frequency</label>
            <select id="frequencyFilterSelect"></select>
          </div>
          <div>
            <label for="themeFilterSelect">Filter by theme</label>
            <select id="themeFilterSelect"></select>
          </div>
          <div>
            <label for="patternFilterSelect">Filter by pattern</label>
            <select id="patternFilterSelect"></select>
          </div>
        </div>
        <div class="flex advanced-actions">
          <button type="button" id="simpleModeBtn">Simplify to common verbs</button>
          <button type="button" class="secondary" id="showAllVerbsBtn">Show every verb</button>
        </div>
      </details>
    </section>

    <section aria-labelledby="verb-table">
      <h2 id="verb-table"><span>2</span>Explore the verbs</h2>
      <p>
        Select verbs to include in your quiz, play the pronunciation, and keep an eye on the accuracy color-coding.
        Green indicates a strong verb, gray is neutral, and red signals a verb to review soon.
      </p>
      <div class="flex" style="justify-content: space-between;">
        <div class="flex">
          <button type="button" class="secondary" id="selectAllBtn">Select all in view</button>
          <button type="button" class="secondary" id="clearSelectionBtn">Clear selection</button>
        </div>
        <div class="flex selection-summary">
          <span class="selection-arrow" aria-hidden="true">&rsaquo;&rsaquo;&rsaquo;</span>
          <span class="selection-text">Selected for quiz</span>
          <span id="selectionCount" class="selection-count">0</span>
          <span class="selection-arrow" aria-hidden="true">&rsaquo;&rsaquo;&rsaquo;&rsaquo;</span>
        </div>
      </div>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th scope="col"><span class="sr-only">Select for quiz</span></th>
              <th scope="col">Base</th>
              <th scope="col">Past</th>
              <th scope="col">Past Participle</th>
              <th scope="col">Catalan</th>
              <th scope="col">Progress</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="verbTable"></tbody>
        </table>
      </div>
    </section>

    <section aria-labelledby="quiz-section">
      <h2 id="quiz-section"><span>3</span>Practice &amp; quiz</h2>
      <div class="quiz-card">
        <p class="quiz-description">
          Use the tracked practice to save your results for next time, or open the flashcards for a quick review with no
          progress tracking.
        </p>
        <div class="controls-grid">
          <div>
            <label for="questionCount">Number of questions</label>
            <input type="number" id="questionCount" min="3" max="50" value="10" />
          </div>
          <div>
            <label for="quizMode">Quiz focus</label>
            <select id="quizMode">
              <option value="mixed">Mix of forms &amp; translations</option>
              <option value="forms">English forms only</option>
              <option value="translation">Catalan to English</option>
            </select>
          </div>
        </div>
        <div class="flex quiz-actions">
          <div class="flex">
            <button type="button" id="startQuizBtn">Start tracked practice</button>
            <button type="button" class="secondary" id="startPracticeBtn">Flashcard practice (no save)</button>
          </div>
          <button type="button" class="secondary" id="resetProgressBtn">Reset saved progress</button>
        </div>
        <div class="quiz-status" id="quizStatus" aria-live="polite"></div>
        <div class="quiz-result" id="quizResult" role="alert"></div>
        <div id="quizPane" style="display: none;">
          <h3 id="quizPrompt"></h3>
          <form id="quizForm"></form>
          <div class="flex">
            <button type="submit" form="quizForm">Check answer</button>
            <button type="button" class="secondary" id="skipQuestionBtn">Skip</button>
          </div>
        </div>
        <div id="flashcardPane" class="flashcard-pane" style="display: none;">
          <h3 id="flashcardPrompt"></h3>
          <p id="flashcardHint"></p>
          <div id="flashcardAnswer" hidden></div>
          <div class="flex">
            <button type="button" id="revealFlashcardBtn">Reveal answer</button>
            <button type="button" class="secondary" id="nextFlashcardBtn">Next card</button>
            <button type="button" class="secondary" id="closeFlashcardBtn">Close practice</button>
          </div>
        </div>
      </div>
    </section>

    <section aria-labelledby="progress-section">
      <h2 id="progress-section"><span>4</span>Progress &amp; review</h2>
      <div class="controls-grid">
        <div>
          <label>Total verbs in curriculum</label>
          <div id="totalVerbs">0</div>
        </div>
        <div>
          <label>Studied verbs</label>
          <div id="studiedVerbs">0</div>
        </div>
        <div>
          <label>Average accuracy</label>
          <div id="averageAccuracy">0%</div>
        </div>
        <div>
          <label>Last review session</label>
          <div id="lastReviewed">—</div>
        </div>
      </div>
      <h3>Hard verbs to review</h3>
      <div id="hardVerbs" class="hard-list"></div>
    </section>
  </main>

  <footer>
    Built for ESL classrooms: American spelling for reference, British answers accepted, Catalan translations included.
    Your progress stays on this device.
  </footer>

  <script>
    const verbs = [
      { base: "arise", past: "arose", participle: "arisen", translation: "sorgir; aixecar-se", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces" },
      { base: "awake", past: "awoke", participle: "awoken", translation: "despertar-se", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "be", past: "was / were", participle: "been", translation: "ser; estar", frequency: "Common", pattern: "Suppletive / unique — 4", theme: "States & Being" },
      { base: "bear", past: "bore", participle: "borne", translation: "suportar; donar a llum", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces" },
      { base: "beat", past: "beat", participle: "beaten", translation: "colpejar; vèncer", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "become", past: "became", participle: "become", translation: "esdevenir", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "States & Being" },
      { base: "befall", past: "befell", participle: "befallen", translation: "succeir", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces" },
      { base: "begin", past: "began", participle: "begun", translation: "començar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "behold", past: "beheld", participle: "beheld", translation: "contemplar", frequency: "Least common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Perception" },
      { base: "bend", past: "bent", participle: "bent", translation: "corbar", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Actions & Impact" },
      { base: "bereave", past: "bereaved / bereft", participle: "bereaved / bereft", translation: "privar", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Emotion & Thought", altPast: ["bereft"], altParticiple: ["bereft"] },
      { base: "beseech", past: "besought", participle: "besought", translation: "suplicar", frequency: "Least common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Communication" },
      { base: "beset", past: "beset", participle: "beset", translation: "assetjar", frequency: "Least common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "bet", past: "bet", participle: "bet", translation: "apostar", frequency: "Common", pattern: "No change — 25", theme: "Transactions" },
      { base: "bid", past: "bid", participle: "bid", translation: "oferir; licitar", frequency: "Less common", pattern: "No change — 25", theme: "Transactions" },
      { base: "bind", past: "bound", participle: "bound", translation: "lligar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Actions & Impact" },
      { base: "bite", past: "bit", participle: "bitten", translation: "mossegar", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces" },
      { base: "bleed", past: "bled", participle: "bled", translation: "sagnar", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Health" },
      { base: "blow", past: "blew", participle: "blown", translation: "bufar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces" },
      { base: "break", past: "broke", participle: "broken", translation: "trencar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "breed", past: "bred", participle: "bred", translation: "criar", frequency: "Least common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Nature & Forces" },
      { base: "bring", past: "brought", participle: "brought", translation: "portar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Movement" },
      { base: "broadcast", past: "broadcast", participle: "broadcast", translation: "emetre", frequency: "Less common", pattern: "No change — 25", theme: "Communication" },
      { base: "build", past: "built", participle: "built", translation: "construir", frequency: "Common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Creation" },
      { base: "burn", past: "burned / burnt", participle: "burned / burnt", translation: "cremar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Nature & Forces", altPast: ["burnt"], altParticiple: ["burnt"] },
      { base: "burst", past: "burst", participle: "burst", translation: "esclatar", frequency: "Less common", pattern: "No change — 25", theme: "Nature & Forces" },
      { base: "buy", past: "bought", participle: "bought", translation: "comprar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Transactions" },
      { base: "cast", past: "cast", participle: "cast", translation: "llençar", frequency: "Less common", pattern: "No change — 25", theme: "Creation" },
      { base: "catch", past: "caught", participle: "caught", translation: "agafar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Movement" },
      { base: "chide", past: "chided / chid", participle: "chided / chidden", translation: "renyar", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Communication", altPast: ["chid"], altParticiple: ["chidden"] },
      { base: "choose", past: "chose", participle: "chosen", translation: "triar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Decisions" },
      { base: "cling", past: "clung", participle: "clung", translation: "aferrar-se", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Emotion & Thought" },
      { base: "clothe", past: "clothed / clad", participle: "clothed / clad", translation: "vestir", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altPast: ["clad"], altParticiple: ["clad"] },
      { base: "come", past: "came", participle: "come", translation: "venir", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Movement" },
      { base: "cost", past: "cost", participle: "cost", translation: "costar", frequency: "Common", pattern: "No change — 25", theme: "Transactions" },
      { base: "creep", past: "crept", participle: "crept", translation: "arrossegar-se", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Movement" },
      { base: "cut", past: "cut", participle: "cut", translation: "tallar", frequency: "Common", pattern: "No change — 25", theme: "Creation" },
      { base: "deal", past: "dealt", participle: "dealt", translation: "negociar; repartir", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Transactions" },
      { base: "dig", past: "dug", participle: "dug", translation: "cavar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Nature & Forces" },
      { base: "do", past: "did", participle: "done", translation: "fer", frequency: "Common", pattern: "Suppletive / unique — 4", theme: "Daily Routines" },
      { base: "draw", past: "drew", participle: "drawn", translation: "dibuixar; estirar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Creation" },
      { base: "dream", past: "dreamed / dreamt", participle: "dreamed / dreamt", translation: "somiar", frequency: "Common", pattern: "Regular alternative available (-ed) — 24", theme: "Emotion & Thought", altPast: ["dreamt"], altParticiple: ["dreamt"] },
      { base: "drink", past: "drank", participle: "drunk", translation: "beure", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "dive", past: "dived / dove", participle: "dived / dove", translation: "capbussar-se", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Movement", altPast: ["dove"], altParticiple: ["dove"] },
      { base: "drive", past: "drove", participle: "driven", translation: "conduir", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "dwell", past: "dwelled / dwelt", participle: "dwelled / dwelt", translation: "residir", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altPast: ["dwelt"], altParticiple: ["dwelt"] },
      { base: "eat", past: "ate", participle: "eaten", translation: "menjar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Daily Routines" },
      { base: "fall", past: "fell", participle: "fallen", translation: "caure", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "feed", past: "fed", participle: "fed", translation: "alimentar", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Daily Routines" },
      { base: "feel", past: "felt", participle: "felt", translation: "sentir", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Emotion & Thought" },
      { base: "fight", past: "fought", participle: "fought", translation: "lluitar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Actions & Impact" },
      { base: "find", past: "found", participle: "found", translation: "trobar", frequency: "Common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Decisions" },
      { base: "flee", past: "fled", participle: "fled", translation: "fugir", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Movement" },
      { base: "fling", past: "flung", participle: "flung", translation: "llençar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Actions & Impact" },
      { base: "fly", past: "flew", participle: "flown", translation: "volar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "forbid", past: "forbade", participle: "forbidden", translation: "prohibir", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Communication" }
    ];
    verbs.push(
      { base: "forget", past: "forgot", participle: "forgotten", translation: "oblidar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "forgive", past: "forgave", participle: "forgiven", translation: "perdonar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "forsake", past: "forsook", participle: "forsaken", translation: "abandonar", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "freeze", past: "froze", participle: "frozen", translation: "gelar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces" },
      { base: "get", past: "got", participle: "gotten", translation: "aconseguir", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Transactions", altParticiple: ["got"] },
      { base: "give", past: "gave", participle: "given", translation: "donar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Transactions" },
      { base: "go", past: "went", participle: "gone", translation: "anar", frequency: "Common", pattern: "Suppletive / unique — 4", theme: "Movement" },
      { base: "grind", past: "ground", participle: "ground", translation: "moldre", frequency: "Least common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Creation" },
      { base: "grow", past: "grew", participle: "grown", translation: "créixer", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces" },
      { base: "hang", past: "hanged / hung", participle: "hanged / hung", translation: "penjar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Actions & Impact", altPast: ["hung"], altParticiple: ["hung"] },
      { base: "have", past: "had", participle: "had", translation: "tenir", frequency: "Common", pattern: "Consonant/spelling tweaks — 8", theme: "States & Being" },
      { base: "hear", past: "heard", participle: "heard", translation: "sentir", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Perception" },
      { base: "hide", past: "hid", participle: "hidden", translation: "amagar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "hit", past: "hit", participle: "hit", translation: "copar", frequency: "Common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "hold", past: "held", participle: "held", translation: "subjectar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Actions & Impact" },
      { base: "hurt", past: "hurt", participle: "hurt", translation: "fer mal", frequency: "Common", pattern: "No change — 25", theme: "Health" },
      { base: "keep", past: "kept", participle: "kept", translation: "mantenir", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "States & Being" },
      { base: "kneel", past: "kneeled / knelt", participle: "kneeled / knelt", translation: "agenollar-se", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altPast: ["knelt"], altParticiple: ["knelt"] },
      { base: "knit", past: "knitted / knit", participle: "knitted / knit", translation: "teixir", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Creation", altPast: ["knit"], altParticiple: ["knit"] },
      { base: "know", past: "knew", participle: "known", translation: "saber; conèixer", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "lay", past: "laid", participle: "laid", translation: "posar", frequency: "Less common", pattern: "Consonant/spelling tweaks — 8", theme: "Actions & Impact" },
      { base: "lead", past: "led", participle: "led", translation: "guiar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Actions & Impact" },
      { base: "lean", past: "leaned / leant", participle: "leaned / leant", translation: "inclinar-se", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Movement", altPast: ["leant"], altParticiple: ["leant"] },
      { base: "leap", past: "leaped / leapt", participle: "leaped / leapt", translation: "saltar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Movement", altPast: ["leapt"], altParticiple: ["leapt"] },
      { base: "leave", past: "left", participle: "left", translation: "marxar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Movement" },
      { base: "lend", past: "lent", participle: "lent", translation: "prestar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Transactions" },
      { base: "let", past: "let", participle: "let", translation: "deixar", frequency: "Common", pattern: "No change — 25", theme: "Communication" },
      { base: "lie", past: "lay", participle: "lain", translation: "estirar-se", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Daily Routines" },
      { base: "light", past: "lighted / lit", participle: "lighted / lit", translation: "encendre", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Nature & Forces", altPast: ["lit"], altParticiple: ["lit"] },
      { base: "lose", past: "lost", participle: "lost", translation: "perdre", frequency: "Common", pattern: "Consonant/spelling tweaks — 8", theme: "Emotion & Thought" },
      { base: "learn", past: "learned / learnt", participle: "learned / learnt", translation: "aprendre", frequency: "Common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altPast: ["learnt"], altParticiple: ["learnt"] },
      { base: "make", past: "made", participle: "made", translation: "fer", frequency: "Common", pattern: "Consonant/spelling tweaks — 8", theme: "Creation" },
      { base: "mean", past: "meant", participle: "meant", translation: "significar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Communication" },
      { base: "meet", past: "met", participle: "met", translation: "trobar-se", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Communication" },
      { base: "mislay", past: "mislaid", participle: "mislaid", translation: "desaparèixer (temporalment)", frequency: "Least common", pattern: "Consonant/spelling tweaks — 8", theme: "Daily Routines" },
      { base: "mistake", past: "mistook", participle: "mistaken", translation: "equivocar-se", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "misunderstand", past: "misunderstood", participle: "misunderstood", translation: "malentendre", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Communication" },
      { base: "overcome", past: "overcame", participle: "overcome", translation: "superar", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Emotion & Thought" },
      { base: "overdo", past: "overdid", participle: "overdone", translation: "exagerar", frequency: "Least common", pattern: "Suppletive / unique — 4", theme: "Emotion & Thought" },
      { base: "overhear", past: "overheard", participle: "overheard", translation: "sentir sense voler", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Perception" },
      { base: "overtake", past: "overtook", participle: "overtaken", translation: "avançar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "partake", past: "partook", participle: "partaken", translation: "participar", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Daily Routines" },
      { base: "pay", past: "paid", participle: "paid", translation: "pagar", frequency: "Common", pattern: "Consonant/spelling tweaks — 8", theme: "Transactions" },
      { base: "plead", past: "pleaded / pled", participle: "pleaded / pled", translation: "suplicar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Communication", altPast: ["pled"], altParticiple: ["pled"] },
      { base: "prove", past: "proved", participle: "proved / proven", translation: "demostrar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Communication", altParticiple: ["proven"] },
      { base: "put", past: "put", participle: "put", translation: "posar", frequency: "Common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "quit", past: "quit", participle: "quit", translation: "deixar", frequency: "Less common", pattern: "No change — 25", theme: "Daily Routines" },
      // Optional ttsBase/ttsPast/ttsParticiple properties override pronunciation for the speech buttons when needed.
      { base: "read", past: "read", participle: "read", ttsPast: "red", ttsParticiple: "red", translation: "llegir", frequency: "Common", pattern: "No change — 25", theme: "Communication" },
      { base: "rid", past: "rid", participle: "rid", translation: "lliurar-se", frequency: "Least common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "ride", past: "rode", participle: "ridden", translation: "muntar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "ring", past: "rang", participle: "rung", translation: "tocar (campana)", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Communication" },
      { base: "rise", past: "rose", participle: "risen", translation: "elevar-se", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces" },
      { base: "run", past: "ran", participle: "run", translation: "córrer", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Movement" }
    );
    verbs.push(
      { base: "say", past: "said", participle: "said", translation: "dir", frequency: "Common", pattern: "Consonant/spelling tweaks — 8", theme: "Communication" },
      { base: "see", past: "saw", participle: "seen", translation: "veure", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Perception" },
      { base: "seek", past: "sought", participle: "sought", translation: "cercar", frequency: "Less common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Decisions" },
      { base: "sell", past: "sold", participle: "sold", translation: "vendre", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Transactions" },
      { base: "send", past: "sent", participle: "sent", translation: "enviar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Communication" },
      { base: "set", past: "set", participle: "set", translation: "col·locar", frequency: "Common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "sew", past: "sewed", participle: "sewn", translation: "cosir", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Creation", altParticiple: ["sewed"] },
      { base: "shake", past: "shook", participle: "shaken", translation: "sacsejar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "shave", past: "shaved", participle: "shaved / shaven", translation: "afaitar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altParticiple: ["shaven"] },
      { base: "shear", past: "sheared", participle: "shorn", translation: "tallar (llana)", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces" },
      { base: "shed", past: "shed", participle: "shed", translation: "perdre; vessar", frequency: "Less common", pattern: "No change — 25", theme: "Nature & Forces" },
      { base: "shine", past: "shined / shone", participle: "shined / shone", translation: "brillar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Nature & Forces", altPast: ["shone"], altParticiple: ["shone"] },
      { base: "shoot", past: "shot", participle: "shot", translation: "disparar", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Actions & Impact" },
      { base: "show", past: "showed", participle: "shown", translation: "mostrar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Communication", altParticiple: ["showed"] },
      { base: "shrink", past: "shrank", participle: "shrunk", translation: "encongir-se", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces", altParticiple: ["shrunken"] },
      { base: "shut", past: "shut", participle: "shut", translation: "tancar", frequency: "Common", pattern: "No change — 25", theme: "Daily Routines" },
      { base: "sing", past: "sang", participle: "sung", translation: "cantar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Communication" },
      { base: "sink", past: "sank", participle: "sunk", translation: "enfonsar", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces", altParticiple: ["sunken"] },
      { base: "sit", past: "sat", participle: "sat", translation: "seure", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "slay", past: "slew", participle: "slain", translation: "matar", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "sleep", past: "slept", participle: "slept", translation: "dormir", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Daily Routines" },
      { base: "slide", past: "slid", participle: "slid", translation: "lliscar", frequency: "Less common", pattern: "Consonant/spelling tweaks — 8", theme: "Movement" },
      { base: "sling", past: "slung", participle: "slung", translation: "llançar", frequency: "Least common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Actions & Impact" },
      { base: "slit", past: "slit", participle: "slit", translation: "esqueixar", frequency: "Least common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "smell", past: "smelled / smelt", participle: "smelled / smelt", translation: "olorar", frequency: "Common", pattern: "Regular alternative available (-ed) — 24", theme: "Perception", altPast: ["smelt"], altParticiple: ["smelt"] },
      { base: "sow", past: "sowed", participle: "sown", translation: "sembrar", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Nature & Forces", altParticiple: ["sowed"] },
      { base: "speak", past: "spoke", participle: "spoken", translation: "parlar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Communication" },
      { base: "speed", past: "sped", participle: "sped", translation: "accelerar", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Movement" },
      { base: "spell", past: "spelled / spelt", participle: "spelled / spelt", translation: "lletrejar", frequency: "Common", pattern: "Regular alternative available (-ed) — 24", theme: "Communication", altPast: ["spelt"], altParticiple: ["spelt"] },
      { base: "spend", past: "spent", participle: "spent", translation: "gastar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Transactions" },
      { base: "spin", past: "spun", participle: "spun", translation: "girar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Movement" },
      { base: "spit", past: "spit", participle: "spit", translation: "escopir", frequency: "Less common", pattern: "No change — 25", theme: "Daily Routines", altPast: ["spat"], altParticiple: ["spat"] },
      { base: "split", past: "split", participle: "split", translation: "dividir", frequency: "Less common", pattern: "No change — 25", theme: "Creation" },
      { base: "spoil", past: "spoiled / spoilt", participle: "spoiled / spoilt", translation: "fer malbé", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Daily Routines", altPast: ["spoilt"], altParticiple: ["spoilt"] },
      { base: "spread", past: "spread", participle: "spread", translation: "estendre", frequency: "Common", pattern: "No change — 25", theme: "Daily Routines" },
      { base: "spring", past: "sprang", participle: "sprung", translation: "saltar", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Movement" },
      { base: "stand", past: "stood", participle: "stood", translation: "estar dret", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "steal", past: "stole", participle: "stolen", translation: "robar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "stick", past: "stuck", participle: "stuck", translation: "enganxar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Actions & Impact" },
      { base: "sting", past: "stung", participle: "stung", translation: "picar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Nature & Forces" },
      { base: "stink", past: "stank", participle: "stunk", translation: "fer pudor", frequency: "Less common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces", altParticiple: ["stunk"] },
      { base: "stride", past: "strode", participle: "stridden", translation: "avançar a grans passes", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Movement" },
      { base: "strike", past: "struck", participle: "struck", translation: "colpejar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Actions & Impact", altParticiple: ["stricken"] },
      { base: "string", past: "strung", participle: "strung", translation: "enfilar", frequency: "Least common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Creation" },
      { base: "strive", past: "strove", participle: "striven", translation: "esforçar-se", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Emotion & Thought" },
      { base: "swear", past: "swore", participle: "sworn", translation: "jurar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Communication" },
      { base: "sweat", past: "sweated / sweat", participle: "sweated / sweat", translation: "suar", frequency: "Less common", pattern: "Regular alternative available (-ed) — 24", theme: "Health", altPast: ["sweat"], altParticiple: ["sweat"] },
      { base: "sweep", past: "swept", participle: "swept", translation: "escombrar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Daily Routines" },
      { base: "swell", past: "swelled", participle: "swelled / swollen", translation: "inflar-se", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Health", altParticiple: ["swollen"] },
      { base: "swim", past: "swam", participle: "swum", translation: "nedar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Movement" },
      { base: "swing", past: "swung", participle: "swung", translation: "balancejar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Movement" },
      { base: "take", past: "took", participle: "taken", translation: "prendre", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "teach", past: "taught", participle: "taught", translation: "ensenyar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Communication" },
      { base: "tear", past: "tore", participle: "torn", translation: "esquinçar", frequency: "Less common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "tell", past: "told", participle: "told", translation: "explicar", frequency: "Common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Communication" },
      { base: "think", past: "thought", participle: "thought", translation: "pensar", frequency: "Common", pattern: "-OUGHT / -AUGHT family — 8", theme: "Emotion & Thought" },
      { base: "thrive", past: "thrived / throve", participle: "thrived / thriven", translation: "prosperar", frequency: "Least common", pattern: "Regular alternative available (-ed) — 24", theme: "Nature & Forces", altPast: ["throve"], altParticiple: ["thriven"] },
      { base: "throw", past: "threw", participle: "thrown", translation: "llençar", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Actions & Impact" },
      { base: "thrust", past: "thrust", participle: "thrust", translation: "clavar", frequency: "Less common", pattern: "No change — 25", theme: "Actions & Impact" },
      { base: "understand", past: "understood", participle: "understood", translation: "entendre", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Emotion & Thought" },
      { base: "uphold", past: "upheld", participle: "upheld", translation: "mantenir", frequency: "Least common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "States & Being" },
      { base: "upset", past: "upset", participle: "upset", translation: "trasbalsar", frequency: "Less common", pattern: "No change — 25", theme: "Emotion & Thought" }
    );
    verbs.push(
      { base: "wake", past: "woke", participle: "woken", translation: "despertar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Daily Routines" },
      { base: "wear", past: "wore", participle: "worn", translation: "portar posat", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Daily Routines" },
      { base: "weave", past: "wove", participle: "woven", translation: "teixir", frequency: "Least common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Creation" },
      { base: "wed", past: "wed", participle: "wed", translation: "casar-se", frequency: "Less common", pattern: "No change — 25", theme: "Daily Routines", altPast: ["wedded"], altParticiple: ["wedded"] },
      { base: "weep", past: "wept", participle: "wept", translation: "plorar", frequency: "Less common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Emotion & Thought" },
      { base: "win", past: "won", participle: "won", translation: "guanyar", frequency: "Common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Actions & Impact" },
      { base: "wind", past: "wound", participle: "wound", translation: "enrotllar", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Movement" },
      { base: "withhold", past: "withheld", participle: "withheld", translation: "retenir", frequency: "Least common", pattern: "E→T/D family (-old/-elt/-ept etc.) — 27", theme: "Transactions" },
      { base: "withstand", past: "withstood", participle: "withstood", translation: "resistir", frequency: "Least common", pattern: "Pure vowel-change (no -n/-en) — 27", theme: "Nature & Forces" },
      { base: "wring", past: "wrung", participle: "wrung", translation: "esprémer", frequency: "Less common", pattern: "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16", theme: "Daily Routines" },
      { base: "write", past: "wrote", participle: "written", translation: "escriure", frequency: "Common", pattern: "“-n / -en / -rn / -wn” participle family — 43", theme: "Communication" }
    );

    const STORAGE_KEY = "irregularVerbProgress_v1";
    const frequencyOrder = ["Common", "Less common", "Least common"];
    const patternOrder = [
      "No change — 25",
      "Regular alternative available (-ed) — 24",
      "“-n / -en / -rn / -wn” participle family — 43",
      "Pure vowel-change (no -n/-en) — 27",
      "-OUGHT / -AUGHT family — 8",
      "E→T/D family (-old/-elt/-ept etc.) — 27",
      "Short-vowel → U shift (-ung/-uck/-ound etc.) — 16",
      "Consonant/spelling tweaks — 8",
      "Suppletive / unique — 4"
    ];
    const selectionSet = new Set();
    let quizQueue = [];
    let quizHistory = [];
    let quizIndex = 0;
    let currentQuestion = null;
    let voices = [];
    let preferredVoice = null;
    let flashcardQueue = [];
    let flashcardIndex = 0;
    let listenTimeouts = [];

    const verbTable = document.getElementById("verbTable");
    const searchInput = document.getElementById("searchInput");
    const selectionCount = document.getElementById("selectionCount");
    const selectAllBtn = document.getElementById("selectAllBtn");
    const clearSelectionBtn = document.getElementById("clearSelectionBtn");
    const quizStatus = document.getElementById("quizStatus");
    const quizResult = document.getElementById("quizResult");
    const quizPane = document.getElementById("quizPane");
    const quizPrompt = document.getElementById("quizPrompt");
    const quizForm = document.getElementById("quizForm");
    const skipQuestionBtn = document.getElementById("skipQuestionBtn");
    const questionCountInput = document.getElementById("questionCount");
    const quizModeSelect = document.getElementById("quizMode");
    const startQuizBtn = document.getElementById("startQuizBtn");
    const startPracticeBtn = document.getElementById("startPracticeBtn");
    const resetProgressBtn = document.getElementById("resetProgressBtn");
    const totalVerbsEl = document.getElementById("totalVerbs");
    const studiedVerbsEl = document.getElementById("studiedVerbs");
    const averageAccuracyEl = document.getElementById("averageAccuracy");
    const lastReviewedEl = document.getElementById("lastReviewed");
    const hardVerbsEl = document.getElementById("hardVerbs");
    const darkModeToggle = document.getElementById("darkModeToggle");
    const frequencyFilterSelect = document.getElementById("frequencyFilterSelect");
    const themeFilterSelect = document.getElementById("themeFilterSelect");
    const patternFilterSelect = document.getElementById("patternFilterSelect");
    const simpleModeBtn = document.getElementById("simpleModeBtn");
    const showAllVerbsBtn = document.getElementById("showAllVerbsBtn");
    const playAllBtn = document.getElementById("playAllBtn");
    const studyModeStatus = document.getElementById("studyModeStatus");
    const flashcardPane = document.getElementById("flashcardPane");
    const flashcardPrompt = document.getElementById("flashcardPrompt");
    const flashcardHint = document.getElementById("flashcardHint");
    const flashcardAnswer = document.getElementById("flashcardAnswer");
    const revealFlashcardBtn = document.getElementById("revealFlashcardBtn");
    const nextFlashcardBtn = document.getElementById("nextFlashcardBtn");
    const closeFlashcardBtn = document.getElementById("closeFlashcardBtn");

    const DEFAULT_FREQUENCY = "Common";
    const frequencyOptions = frequencyOrder.filter((option) => verbs.some((verb) => verb.frequency === option));
    const themeOptions = Array.from(new Set(verbs.map((verb) => verb.theme))).sort((a, b) => a.localeCompare(b));
    const patternOptions = patternOrder.filter((option) => verbs.some((verb) => verb.pattern === option));

    const progress = loadProgress();
    totalVerbsEl.textContent = verbs.length;

    function loadProgress() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return {};
        return JSON.parse(saved);
      } catch (error) {
        console.error("Unable to load progress", error);
        return {};
      }
    }

    function saveProgress() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
    }

    function formatPercent(value) {
      return `${Math.round(value * 100)}%`;
    }

    function populateFilterSelect(select, options, defaultLabel) {
      select.innerHTML = "";
      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = defaultLabel;
      select.appendChild(defaultOption);

      options.forEach((option) => {
        const opt = document.createElement("option");
        opt.value = option;
        opt.textContent = option;
        select.appendChild(opt);
      });
    }

    function initializeFilterSelects() {
      populateFilterSelect(frequencyFilterSelect, frequencyOptions, "All frequencies");
      populateFilterSelect(themeFilterSelect, themeOptions, "All themes");
      populateFilterSelect(patternFilterSelect, patternOptions, "All patterns");

      frequencyFilterSelect.addEventListener("change", applyFilters);
      themeFilterSelect.addEventListener("change", applyFilters);
      patternFilterSelect.addEventListener("change", applyFilters);
    }

    function applyDefaultFilters() {
      frequencyFilterSelect.value = DEFAULT_FREQUENCY;
      themeFilterSelect.value = "";
      patternFilterSelect.value = "";
    }

    function setDefaultSelection() {
      selectionSet.clear();
      verbs.forEach((verb) => {
        if (verb.frequency === DEFAULT_FREQUENCY) {
          selectionSet.add(verb.base);
        }
      });
      updateSelectionCount();
    }

    function resetToDefaultView() {
      applyDefaultFilters();
      setDefaultSelection();
      searchInput.value = "";
      applyFilters();
    }

    function getFilteredVerbs() {
      const searchTerm = searchInput.value.trim().toLowerCase();

      return verbs
        .filter((verb) => {
          const matchesSearch = !searchTerm ||
            verb.base.toLowerCase().includes(searchTerm) ||
            verb.translation.toLowerCase().includes(searchTerm) ||
            verb.past.toLowerCase().includes(searchTerm) ||
            verb.participle.toLowerCase().includes(searchTerm);

          const matchesFrequencyFilter = !frequencyFilterSelect.value || frequencyFilterSelect.value === verb.frequency;
          const matchesThemeFilter = !themeFilterSelect.value || themeFilterSelect.value === verb.theme;
          const matchesPatternFilter = !patternFilterSelect.value || patternFilterSelect.value === verb.pattern;

          return matchesSearch && matchesFrequencyFilter && matchesThemeFilter && matchesPatternFilter;
        })
        .sort((a, b) => {
          const aIndex = frequencyOrder.indexOf(a.frequency);
          const bIndex = frequencyOrder.indexOf(b.frequency);
          const freqDiff = (aIndex === -1 ? Number.MAX_SAFE_INTEGER : aIndex) - (bIndex === -1 ? Number.MAX_SAFE_INTEGER : bIndex);
          if (freqDiff !== 0) return freqDiff;
          return a.base.localeCompare(b.base);
        });
    }

    function stopListeningSequence() {
      listenTimeouts.forEach((timeout) => clearTimeout(timeout));
      listenTimeouts = [];
      window.speechSynthesis.cancel();
    }

    function applyFilters() {
      stopListeningSequence();
      renderVerbTable(getFilteredVerbs());
    }

    function startListeningToCurrentList() {
      const verbsToPlay = getFilteredVerbs().slice(0, 12);
      if (!verbsToPlay.length) {
        if (studyModeStatus) {
          studyModeStatus.textContent = "No verbs available to listen to. Adjust your filters in More verbs.";
        }
        return;
      }

      stopListeningSequence();

      if (studyModeStatus) {
        studyModeStatus.textContent = `Listening through ${verbsToPlay.length} verb${verbsToPlay.length === 1 ? "" : "s"}.`;
      }

      let delay = 0;
      verbsToPlay.forEach((verb, index) => {
        listenTimeouts.push(setTimeout(() => {
          if (studyModeStatus) {
            studyModeStatus.textContent = `Listening: ${verb.base} (${index + 1}/${verbsToPlay.length})`;
          }
          speakIfRequested(verb.ttsBase || verb.base);
        }, delay));
        delay += 1100;
        listenTimeouts.push(setTimeout(() => {
          speakIfRequested(verb.ttsPast || verb.past);
        }, delay));
        delay += 1100;
        listenTimeouts.push(setTimeout(() => {
          speakIfRequested(verb.ttsParticiple || verb.participle);
        }, delay));
        delay += 1400;
      });

      listenTimeouts.push(setTimeout(() => {
        if (studyModeStatus) {
          studyModeStatus.textContent = `Finished listening to ${verbsToPlay.length} verb${verbsToPlay.length === 1 ? "" : "s"}.`;
        }
      }, delay));
    }

    function renderVerbTable(list) {
      const fragment = document.createDocumentFragment();
      if (!list.length) {
        const row = document.createElement("tr");
        row.className = "empty-row";
        const cell = document.createElement("td");
        cell.colSpan = 7;
        cell.textContent = "No verbs match your search.";
        row.appendChild(cell);
        verbTable.innerHTML = "";
        verbTable.appendChild(row);
        updateSelectionCount();
        return;
      }
      list.forEach((verb) => {
        const row = document.createElement("tr");
        const entryKey = verb.base.toLowerCase();
        const stats = progress[entryKey] || { correct: 0, incorrect: 0 };
        const total = stats.correct + stats.incorrect;
        const accuracy = total ? stats.correct / total : 0;
        let statsClass = "neutral";
        if (total && accuracy >= 0.75) statsClass = "good";
        else if (total && accuracy < 0.6) statsClass = "bad";

        row.innerHTML = `
          <td><input type="checkbox" data-verb="${verb.base}" ${selectionSet.has(verb.base) ? "checked" : ""}></td>
          <td>${verb.base}</td>
          <td>${verb.past}</td>
          <td>${verb.participle}</td>
          <td>${verb.translation}</td>
          <td><span class="stats-pill ${statsClass}">${total ? `${Math.round(accuracy * 100)}%` : "New"}</span></td>
          <td class="verb-actions">
            <button type="button" data-tts="${verb.ttsBase || verb.base}" data-verb="${verb.base}">🔊 Base</button>
            <button type="button" data-tts="${verb.ttsPast || verb.past}" data-verb="${verb.base}">🔊 Past</button>
            <button type="button" data-tts="${verb.ttsParticiple || verb.participle}" data-verb="${verb.base}">🔊 Participle</button>
          </td>
        `;
        fragment.appendChild(row);
      });
      verbTable.innerHTML = "";
      verbTable.appendChild(fragment);
      updateSelectionCount();
    }

    function updateSelectionCount() {
      selectionCount.textContent = selectionSet.size;
    }

    function speakIfRequested(text) {
      if (!text) return;
      const utterance = new SpeechSynthesisUtterance(text);
      if (!preferredVoice && voices.length) {
        preferredVoice = choosePreferredVoice(voices);
      }
      if (preferredVoice) {
        utterance.voice = preferredVoice;
      }
      utterance.rate = 0.95;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }

    function handleTableInteraction(event) {
      const checkbox = event.target.closest('input[type="checkbox"]');
      if (checkbox) {
        const verb = checkbox.dataset.verb;
        if (checkbox.checked) {
          selectionSet.add(verb);
        } else {
          selectionSet.delete(verb);
        }
        updateSelectionCount();
        return;
      }

      const button = event.target.closest('button[data-tts]');
      if (button) {
        speakIfRequested(button.dataset.tts);
      }
    }

    function selectAllCurrent() {
      document.querySelectorAll('#verbTable input[type="checkbox"]').forEach((checkbox) => {
        checkbox.checked = true;
        selectionSet.add(checkbox.dataset.verb);
      });
      updateSelectionCount();
    }

    function clearSelection() {
      selectionSet.clear();
      document.querySelectorAll('#verbTable input[type="checkbox"]').forEach((checkbox) => {
        checkbox.checked = false;
      });
      updateSelectionCount();
    }

    function shuffle(array) {
      const copy = [...array];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function normalizedAnswers(verb) {
      const base = verb.base.toLowerCase();
      const past = verb.past.toLowerCase().split(/\s*\/\s*/);
      const participle = verb.participle.toLowerCase().split(/\s*\/\s*/);
      const altPast = (verb.altPast || []).map((item) => item.toLowerCase());
      const altParticiple = (verb.altParticiple || []).map((item) => item.toLowerCase());
      return {
        base,
        past: new Set([...past, ...altPast]),
        participle: new Set([...participle, ...altParticiple])
      };
    }

    function prepareQuiz() {
      const requested = Number.parseInt(questionCountInput.value, 10) || 10;
      const selected = verbs.filter((verb) => selectionSet.has(verb.base));
      const pool = selected.length ? selected : verbs;
      const amount = Math.min(requested, pool.length);
      quizQueue = shuffle(pool).slice(0, amount);
      quizHistory = [];
      quizIndex = 0;
      quizResult.style.display = "none";
      endFlashcardPractice({ silent: true });
      quizPane.style.display = "block";
      renderQuizStatus();
      nextQuestion();
    }

    function renderQuizStatus() {
      quizStatus.innerHTML = `
        <span>Tracked practice</span>
        <span>Question ${Math.min(quizIndex + 1, quizQueue.length)} / ${quizQueue.length}</span>
        <span>Score: ${quizHistory.filter((item) => item.correct).length} correct</span>
      `;
    }

    function getPracticePool() {
      const selected = verbs.filter((verb) => selectionSet.has(verb.base));
      if (selected.length) {
        return selected;
      }
      return verbs.filter((verb) => verb.frequency === DEFAULT_FREQUENCY);
    }

    function startFlashcardPractice() {
      const pool = getPracticePool();
      if (!pool.length) {
        quizStatus.textContent = "No verbs available for practice.";
        return;
      }
      const requested = Number.parseInt(questionCountInput.value, 10) || pool.length;
      const amount = Math.min(requested, pool.length);
      flashcardQueue = shuffle(pool).slice(0, amount);
      flashcardIndex = 0;
      quizPane.style.display = "none";
      quizResult.style.display = "none";
      flashcardPane.style.display = "grid";
      renderFlashcard();
    }

    function renderFlashcard() {
      if (!flashcardQueue.length) {
        quizStatus.textContent = "No verbs available for practice.";
        flashcardPane.style.display = "none";
        return;
      }

      if (flashcardIndex >= flashcardQueue.length) {
        flashcardQueue = shuffle(flashcardQueue);
        flashcardIndex = 0;
      }

      const verb = flashcardQueue[flashcardIndex];
      const type = Math.random() > 0.5 ? "forms" : "translation";

      flashcardAnswer.hidden = true;
      revealFlashcardBtn.disabled = false;
      nextFlashcardBtn.disabled = true;

      if (type === "forms") {
        flashcardPrompt.textContent = `Base form: ${verb.base}`;
        flashcardHint.textContent = "Think of the past and past participle.";
        flashcardAnswer.textContent = `${verb.past} · ${verb.participle}`;
      } else {
        flashcardPrompt.textContent = `Catalan meaning: ${verb.translation}`;
        flashcardHint.textContent = "Say the English base form.";
        flashcardAnswer.textContent = verb.base;
      }

      quizStatus.textContent = `Flashcard ${flashcardIndex + 1} / ${flashcardQueue.length} — Mixed forms & translations (not saved)`;
    }

    function advanceFlashcard() {
      if (!flashcardQueue.length) return;
      flashcardIndex += 1;
      if (flashcardIndex >= flashcardQueue.length) {
        flashcardQueue = shuffle(flashcardQueue);
        flashcardIndex = 0;
      }
      renderFlashcard();
    }

    function endFlashcardPractice({ silent = false } = {}) {
      flashcardPane.style.display = "none";
      flashcardPrompt.textContent = "";
      flashcardHint.textContent = "";
      flashcardAnswer.textContent = "";
      flashcardAnswer.hidden = true;
      revealFlashcardBtn.disabled = false;
      nextFlashcardBtn.disabled = true;
      if (!silent) {
        quizStatus.textContent = "Flashcard practice closed.";
      }
    }

    function buildQuizForm(question) {
      quizForm.innerHTML = "";
      if (question.type === "forms") {
        quizPrompt.textContent = `Complete the forms for \"${question.verb.base}\".`;
        quizForm.innerHTML = `
          <label>Past <input type="text" name="past" autocomplete="off" required></label>
          <label>Past participle <input type="text" name="participle" autocomplete="off" required></label>
        `;
      } else {
        quizPrompt.textContent = `Translate into English: ${question.verb.translation}`;
        quizForm.innerHTML = `
          <label>Base form <input type="text" name="base" autocomplete="off" required></label>
        `;
      }
    }

    function nextQuestion() {
      if (!quizQueue.length || quizIndex >= quizQueue.length) {
        finishQuiz();
        return;
      }
      currentQuestion = createQuestion(quizQueue[quizIndex]);
      buildQuizForm(currentQuestion);
      const firstInput = quizForm.querySelector("input");
      if (firstInput) {
        firstInput.focus();
      }
    }

    function createQuestion(verb) {
      const mode = quizModeSelect.value;
      const type = mode === "mixed" ? (Math.random() > 0.5 ? "forms" : "translation") : mode;
      return { verb, type };
    }

    function evaluateAnswer(formData) {
      const info = normalizedAnswers(currentQuestion.verb);
      let correct = true;
      const feedback = [];

      if (currentQuestion.type === "forms") {
        const pastAnswer = (formData.get("past") || "").trim().toLowerCase();
        const participleAnswer = (formData.get("participle") || "").trim().toLowerCase();
        if (!info.past.has(pastAnswer)) {
          correct = false;
          feedback.push(`Past: ${currentQuestion.verb.past}`);
        }
        if (!info.participle.has(participleAnswer)) {
          correct = false;
          feedback.push(`Participle: ${currentQuestion.verb.participle}`);
        }
      } else {
        const baseAnswer = (formData.get("base") || "").trim().toLowerCase();
        if (baseAnswer !== info.base) {
          correct = false;
          feedback.push(`Base: ${currentQuestion.verb.base}`);
        }
      }

      return { correct, feedback };
    }

    function recordResult(verb, wasCorrect) {
      const key = verb.base.toLowerCase();
      const entry = progress[key] || { correct: 0, incorrect: 0 };
      if (wasCorrect) entry.correct += 1;
      else entry.incorrect += 1;
      entry.lastReviewed = new Date().toISOString();
      progress[key] = entry;
      saveProgress();
    }

    function finishQuiz() {
      quizPane.style.display = "none";
      quizPrompt.textContent = "Quiz finished!";
      const correctAnswers = quizHistory.filter((item) => item.correct).length;
      quizResult.textContent = `You answered ${correctAnswers} out of ${quizHistory.length} correctly.`;
      quizResult.className = "quiz-result " + (correctAnswers / Math.max(quizHistory.length, 1) >= 0.7 ? "correct" : "incorrect");
      quizResult.style.display = "block";
      updateProgressSummary();
      renderHardVerbs();
    }

    quizForm.addEventListener("submit", (event) => {
      event.preventDefault();
      if (!currentQuestion) return;
      const formData = new FormData(quizForm);
      const { correct, feedback } = evaluateAnswer(formData);
      recordResult(currentQuestion.verb, correct);
      quizHistory.push({ verb: currentQuestion.verb, correct });
      quizIndex += 1;
      renderQuizStatus();

      if (correct) {
        quizResult.textContent = "Correct!";
        quizResult.className = "quiz-result correct";
      } else {
        quizResult.textContent = `Check again: ${feedback.join(" | ")}`;
        quizResult.className = "quiz-result incorrect";
      }
      quizResult.style.display = "block";
      updateProgressSummary();
      renderHardVerbs();
      setTimeout(() => {
        quizResult.style.display = "none";
        nextQuestion();
      }, 1800);
    });

    skipQuestionBtn.addEventListener("click", () => {
      if (!currentQuestion) return;
      quizHistory.push({ verb: currentQuestion.verb, correct: false });
      recordResult(currentQuestion.verb, false);
      quizIndex += 1;
      renderQuizStatus();
      quizResult.textContent = `Skipped. Correct forms: ${currentQuestion.verb.past} | ${currentQuestion.verb.participle}`;
      quizResult.className = "quiz-result incorrect";
      quizResult.style.display = "block";
      updateProgressSummary();
      renderHardVerbs();
      setTimeout(() => {
        quizResult.style.display = "none";
        nextQuestion();
      }, 1800);
    });

    selectAllBtn.addEventListener("click", selectAllCurrent);
    clearSelectionBtn.addEventListener("click", clearSelection);
    verbTable.addEventListener("click", handleTableInteraction);

    startQuizBtn.addEventListener("click", () => {
      if (!verbs.length) return;
      stopListeningSequence();
      prepareQuiz();
    });

    startPracticeBtn.addEventListener("click", () => {
      if (!verbs.length) return;
      stopListeningSequence();
      startFlashcardPractice();
    });

    revealFlashcardBtn.addEventListener("click", () => {
      flashcardAnswer.hidden = false;
      revealFlashcardBtn.disabled = true;
      nextFlashcardBtn.disabled = false;
    });

    nextFlashcardBtn.addEventListener("click", () => {
      advanceFlashcard();
    });

    closeFlashcardBtn.addEventListener("click", () => {
      endFlashcardPractice();
    });

    resetProgressBtn.addEventListener("click", () => {
      if (!confirm("Remove all saved progress for this device?")) return;
      Object.keys(progress).forEach((key) => delete progress[key]);
      saveProgress();
      updateProgressSummary();
      renderHardVerbs();
      document.querySelectorAll('#verbTable input[type="checkbox"]').forEach((checkbox) => {
        const row = checkbox.closest("tr");
        if (row) {
          const pill = row.querySelector(".stats-pill");
          if (pill) {
            pill.textContent = "New";
            pill.className = "stats-pill neutral";
          }
        }
      });
      quizResult.textContent = "Progress cleared.";
      quizResult.className = "quiz-result";
      quizResult.style.display = "block";
      setTimeout(() => (quizResult.style.display = "none"), 1800);
    });

    playAllBtn.addEventListener("click", () => {
      resetToDefaultView();
      endFlashcardPractice({ silent: true });
      startListeningToCurrentList();
      document.getElementById("verb-table").scrollIntoView({ behavior: "smooth", block: "start" });
    });

    searchInput.addEventListener("input", () => {
      applyFilters();
    });

    simpleModeBtn.addEventListener("click", () => {
      resetToDefaultView();
      const container = simpleModeBtn.closest("details");
      if (container) {
        container.open = false;
      }
    });

    showAllVerbsBtn.addEventListener("click", () => {
      frequencyFilterSelect.value = "";
      themeFilterSelect.value = "";
      patternFilterSelect.value = "";
      applyFilters();
    });

    function updateProgressSummary() {
      const entries = Object.entries(progress);
      const studied = entries.filter(([, value]) => (value.correct || value.incorrect)).length;
      const totalAttempts = entries.reduce((sum, [, value]) => sum + value.correct + value.incorrect, 0);
      const accuracy = entries.reduce((sum, [, value]) => sum + (value.correct || 0), 0) / Math.max(totalAttempts, 1);
      const lastTimestamp = entries.reduce((latest, [, value]) => {
        if (!value.lastReviewed) return latest;
        const time = Date.parse(value.lastReviewed);
        return Number.isNaN(time) ? latest : Math.max(latest, time);
      }, 0);

      studiedVerbsEl.textContent = studied;
      averageAccuracyEl.textContent = totalAttempts ? formatPercent(accuracy) : "0%";
      lastReviewedEl.textContent = lastTimestamp ? new Date(lastTimestamp).toLocaleString() : "—";
    }

    function renderHardVerbs() {
      hardVerbsEl.innerHTML = "";
      const hardList = verbs.filter((verb) => {
        const entry = progress[verb.base.toLowerCase()];
        if (!entry) return false;
        const total = (entry.correct || 0) + (entry.incorrect || 0);
        if (total < 2) return false;
        const accuracy = (entry.correct || 0) / total;
        return accuracy < 0.7 || entry.incorrect >= 2;
      });

      if (!hardList.length) {
        hardVerbsEl.innerHTML = '<div class="empty-state">Great job! No hard verbs to review yet.</div>';
        return;
      }

      hardList.forEach((verb) => {
        const entry = progress[verb.base.toLowerCase()];
        const total = entry.correct + entry.incorrect;
        const accuracy = entry.correct / Math.max(total, 1);
        const card = document.createElement("article");
        card.className = "hard-card";
        card.innerHTML = `
          <h4>${verb.base} → ${verb.past} → ${verb.participle}</h4>
          <p>${verb.translation}</p>
          <p>Attempts: ${total} · Accuracy: ${formatPercent(accuracy)}</p>
          <div class="verb-actions">
            <button type="button" data-tts="${verb.base}" data-verb="${verb.base}">🔊 Base</button>
            <button type="button" data-tts="${verb.past}" data-verb="${verb.base}">🔊 Past</button>
            <button type="button" data-tts="${verb.participle}" data-verb="${verb.base}">🔊 Participle</button>
          </div>
        `;
        hardVerbsEl.appendChild(card);
      });
    }

    function choosePreferredVoice(list) {
      if (!list.length) return null;
      const googleUsEnglish = list.find((voice) => voice.lang === "en-US" && /google us english/i.test(voice.name));
      if (googleUsEnglish) return googleUsEnglish;
      const googleEnglish = list.find((voice) => voice.lang.startsWith("en") && /google/i.test(voice.name));
      if (googleEnglish) return googleEnglish;
      const americanEnglish = list.find((voice) => voice.lang === "en-US");
      if (americanEnglish) return americanEnglish;
      const anyEnglish = list.find((voice) => voice.lang.startsWith("en"));
      return anyEnglish || list[0];
    }

    function initVoices() {
      function populateVoices() {
        voices = window.speechSynthesis.getVoices().filter((voice) => voice.lang.startsWith("en"));
        preferredVoice = choosePreferredVoice(voices);
      }
      populateVoices();
      window.speechSynthesis.onvoiceschanged = populateVoices;
    }

    function updateDarkModeButton() {
      if (!darkModeToggle) return;
      const isDark = document.body.classList.contains("dark");
      const icon = isDark ? "☀️" : "🌙";
      const label = isDark ? "Switch to light mode" : "Switch to dark mode";
      darkModeToggle.innerHTML = `<span aria-hidden="true">${icon}</span>`;
      darkModeToggle.setAttribute("aria-label", label);
      darkModeToggle.setAttribute("title", label);
    }

    function restoreDarkMode() {
      const stored = localStorage.getItem("irregularVerbCoachTheme");
      if (stored === "dark") {
        document.body.classList.add("dark");
      }
      updateDarkModeButton();
    }

    darkModeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      const mode = document.body.classList.contains("dark") ? "dark" : "light";
      localStorage.setItem("irregularVerbCoachTheme", mode);
      updateDarkModeButton();
    });

    document.addEventListener("DOMContentLoaded", () => {
      restoreDarkMode();
      initVoices();
      initializeFilterSelects();
      applyDefaultFilters();
      setDefaultSelection();
      renderVerbTable(getFilteredVerbs());
      updateProgressSummary();
      renderHardVerbs();
    });
  </script>
</body>
</html>
